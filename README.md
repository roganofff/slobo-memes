# Итоговый проект "Бот для мемов" по дисциплине "Разработка программных модулей"

## Описание задачи
В рамках итогового проекта требуется создать телеграм-бота для обмена мемами, который позволяет пользователям загружать свои мемы, смотреть другие загруженные мемы, выставлять им оценку (лайк / дизлайк), добавлять к себе в "Сохраненки", изменять видимость (публичный / приватный) своего загруженного мема для других пользователей.

## Цель
Разработать и продемострировать рабочий прототип телеграмм-бота для обмена мемами. Проект должен включать в себя использование следующих технологий:

- FastAPI
- Docker
- RabbitMQ
- Aiogram

## Участники и контакты
- Роганов Егор
    - Telegram: [@roganofff](https://t.me/roganofff)
- Дятлова Мария
    - Teleram: [@tofick_brodaga](https://t.me/tofick_brodaga)
- Тюрин Артём
    - Telegram: [@rrtire](https://t.me/rrtire)

## Функционал проекта
1. При запуске бота через команду _/start_ бот отправляет приветственное сообщение и сообщение с главным меню.
2. При отправке боту сообщения "Главное меню" вне зависимости от того где сейчас находится пользователь будет открыто главное меню.
3. В главном меню:
    - Отображается фото профиля пользователя
    - Отображается telegram id пользователя
    - Отображается telegram username пользователя
    - Inline-кнопки:
        - Добавить мем
        - Случайный общий мем
        - Случайный личный мем
        - Мои сохраненки
        - Популярный мем
4. При нажатии на "Добавить мем":
    - Бот ждет от пользователя мем в виде фотографии с необязательной подписью к нему до 250 символов.
    - Если поьлзователь отправил текст без фото или фото с текстом более 250 символов, то ему выводится ошибка. Бот продолжает ждать отправку корректного мема.
    - Inline-кнопка "Назад" возвращает в главное меню.
    - После отправки коректного мема бот его обрабатывает и показывает пользователю.
    - По умолчанию мем помечается как приватный и автоматически добавляется в сохраненки пользователя.
5. При нажатии на "Случайный общий" бот показывает пользователю случайный общий мем
    - Кнопка "Еще!" - показывает следующий случайный общий мем (иногда может выпасть уже отображающийся)
6. При нажатии на "Случайный личный" бот показывает пользователю случайный мем из его сохраненок
    - Кнопка "Еще!" - показывает следующий случайный личный мем (иногда может выпасть уже отображающийся)
7. При нажатии на "Мои сохры" под показывает пользователю список сохраненных им к себе мемов с возможностью листать их (следующий / предыдущий) при помощи соответствующих кнопок в виде стрелок.
8. При нажатии на "Популярный" пользователю показывается самы популярный мем по количеству лайков
9. Мем:
    - Отображается изображение мема
    - При наличии подписи к мему она тоже отображается
    - Кнопки:
        - "Назад" - возвращает пользователя в главное меню
        - "Добавить к себе" - добавляет мем в сохраненки пользователя
        - "Удалить из своих" - удаляет мем из сохраненок пользователя
        - "Нрав N" - помечает мем понравившимся. N - число лайков. Отображается только если мем публичный.
        - "[Нрав N]" - убирает лайк с мема. N - число лайков. Отображается только если мем публичный.
        - "Ненрав N" - помечает мем как непонравившийся. N - число дизлайков. Отображается только если мем публичный.
        - "[Ненрав N]" - убирает дизлайк с мема. N - число дизлайков. Отображается только если мем публичный.
        - "Сделать приватным" - делает мем приватным. Отображается только если пользователь владелец мема (добавил его).
        - "Сделать публичным" - делает мем публичным. Отображается только если пользователь владелец мема (добавил его).
        - "Удалить" - удаляет мем из базы бота. Отображается только если пользователь владелец мема (добавил его).

## Требования
- **Python** 3.11
- **Docker** 27.3.1
- **Docker Compose** 2.29.2 
- **Poetry** 1.8.2

## Установка
### 1. Склонируйте репозиторий
Перейдите в директорию и выполните команду:
```
git clone https://github.com/roganofff/slobo-memes.git
```
### 2. Настройка
В проекте есть 3 примера конфига:
```
- bot/config/.env.example
- database/config/.env.example
- rabbitmq/config/.env.example
```

Необходимо переименовать каждый из них в `.env` и поменять данные внутри каждого под себя:
#### rabbitmq/config/.env
- `RABBIT_PORT` - порт, на котором будет запущен RabbitMQ. Можно не менять.
- `RABBIT_WEB_PORT` - порт, на котором будет запущен веб-интерфейс RabbitMQ. Можно не менять.
- `RABBIT_DEFAULT_USER` - логин для подключения к RabbitMQ и входа в веб-интерфейс.
- `RABBIT_DEFAULT_PASS` - пароль для подключения к RabbitMQ и входа в веб-интерфейс.

#### database/config/.env
- `POSTGRES_HOST` - ip, на котором запущена база данных. Если все контейнеры запускаются в одной сети, то не менять.
- `POSTGRES_PORT` - порт, на котором запущена база данных. Если не изменено внутри docker-compose, то не менять.
- `POSTGRES_DB` - имя запущеной базы данных
- `POSTGRES_USER` - логин для подключения к базе дыннх
- `POSTGRES_PASSWORD` - пароль для подключения к базе данных
- `DB_RABBIT_PORT` - порт, на котором запущен RabbitMQ. Должен быть таким же, как `RABBIT_PORT` из `rabbit/config/.env`
- `DB_RABBIT_DEFAULT_USER` - логин для подключения к RabbitMQ. Должен быть таким же, как `RABBIT_PORT` из `rabbit/config/.env`
- `DB_RABBIT_DEFAULT_PASS` - пароль для подключения к RabbitMQ. Должен быть таким же, как `RABBIT_PORT` из `rabbit/config/.env`
- `IMAGE_HOST_API_KEY` - API ключ для [FreeImageHost](https://freeimage.host/). Можно получить [здесь](https://freeimage.host/page/api)

#### bot/config/.env
- `BOT_TOKEN` - токен телеграм-бота. Можно получить у [BotFather](https://t.me/botfather)
- `BOT_WEBHOOK_PATH` - путь, на который будут слаться WebHook запросы
- `BOT_FASTAPI_HOST` - хост, на который будут слаться WebHook запросы. Должен быть пустым, если бот не должен работать на WebHook. На домене обязательно должен быть SSL сертификат, иначе телеграм выдаст ошибку.
- `BOT_FASTAPI_PORT` - порт, на который будут слаться WebHook запросы.
- `DB_RABBIT_PORT` - порт, на котором запущен RabbitMQ. Должен быть таким же, как `RABBIT_PORT` из `rabbit/config/.env`
- `DB_RABBIT_DEFAULT_USER` - логин для подключения к RabbitMQ. Должен быть таким же, как `RABBIT_PORT` из `rabbit/config/.env`
- `DB_RABBIT_DEFAULT_PASS` - пароль для подключения к RabbitMQ. Должен быть таким же, как `RABBIT_PORT` из `rabbit/config/.env`
- `IMAGE_HOST_API_KEY` - API ключ для [FreeImageHost](https://freeimage.host/). Можно получить [здесь](https://freeimage.host/page/api)

### 3. Запуск
Из директории, в которой находится `docker-compose.yml` выполнить команду:
```
sudo scripts/start.sh
```

Или, если нужно смотреть логи работы приложения в терминале (перейти в attached режим), то команду:
```
sudo scripts/start_with_logs.sh
```

Для остановки бота выполнить команду:
```
sudo scripts/stop.sh
```

Для пересборки бота команда:
```
sudo scripts/rebuild.sh
```
